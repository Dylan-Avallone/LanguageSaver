<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{ exercise.title }}</title>
  
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  
    <style>
      .highlighted {
        background-color: #007bff !important;
        color: white !important;
        border: 2px solid #0056b3 !important;
      }
    </style>
  </head>

<body>
  <div class="text-center mt-4">
    <a href="/" class="btn btn-secondary">Back to Exercise Selection</a>
  </div>
<!-- Ensure content only appears for Ser vs. Estar -->
{% if exercise_key == "ser_estar" %}
    <h1 class="text-center">{{ exercise.title }}</h1>

    <div class="mt-4">
      <h3 style="font-size: 50px;">Definitions</h3>
      <ul>
        <li style="font-size: 28px;">Same Word, Different Meanings</li>
        <li style="font-size: 22px;">
          In English, we use <strong>"to be"</strong> for everything:
          But in Spanish, you must choose <strong>ser</strong> or <strong>estar</strong> based on the
          <button type="button" class="btn btn-link p-0 mb-1" data-bs-toggle="modal" data-bs-target="#situationModal" style="text-decoration: underline; font-size: 22px; color: #007bff;">
            <strong>situation</strong>
          </button>
        </li>
      </ul>
    </div>

    <!-- Situation Modal for Ser vs. Estar -->
    <div class="modal fade" id="situationModal" tabindex="-1" aria-labelledby="situationModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
          <div class="modal-content">
              <h5 class="modal-title text-center p-3" id="situationModalLabel">Explanation</h5>
              <div class="modal-body text-center">
                  <div class="row">
                      <!-- Left Column for Ser -->
                      <div class="col-md-6">
                          <strong class="identity">Ser (Permanent or Defining Traits)</strong>
                          <ul>
                              <li><strong class="identity">Identity</strong>: Soy Juan. (I am Juan.)</li>
                              <li><strong class="characteristics">Characteristics</strong>: √âl es alto. (He is tall.)</li>
                              <li><strong class="origin">Origin/Nationality</strong>: Somos de M√©xico. (We are from Mexico.)</li>
                              <li><strong class="time-date">Time/Date</strong>: Hoy es martes. (Today is Tuesday.)</li>
                              <li><strong class="material">Material/Ownership</strong>: La mesa es de madera. (The table is made of wood.)</li>
                          </ul>
                      </div>

                      <!-- Right Column for Estar -->
                      <div class="col-md-6">
                          <strong class="location">Estar (Temporary or Changing States)</strong>
                          <ul>
                              <li><strong class="location">Location</strong>: Estoy en la casa. (I am at home.)</li>
                              <li><strong class="emotions">Emotions/Conditions</strong>: Est√° triste. (He is sad.)</li>
                              <li><strong class="ongoing">Ongoing Actions</strong>: Estoy estudiando. (I am studying.)</li>
                              <li><strong class="results">Results of Actions</strong>: La puerta est√° abierta. (The door is open.)</li>
                          </ul>
                      </div>
                  </div>
              </div>
              <button class="btn btn-secondary mx-auto w-50 mb-3" data-bs-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
  {% elif exercise_key == "haber_tener" %}
  <h1 class="text-center">{{ exercise.title }}</h1>

  <div class="mt-4">
      <h3 style="font-size: 50px;">Definitions</h3>
      <ul>
          <li style="font-size: 22px;">
              In Spanish, both <strong>haber</strong> and <strong>tener</strong> mean 'To Have' in English. 
              But they are used in differently depending on the 
              <button type="button" class="btn btn-link p-0 mb-1" data-bs-toggle="modal" data-bs-target="#situationModal" 
                      style="text-decoration: underline; font-size: 22px; color: #007bff;">
                  <strong>situation</strong>
              </button>.
          </li>
      </ul>
  </div>
    <!-- Situation Modal for Haber vs. Tener -->
    <div class="modal fade" id="situationModal" tabindex="-1" aria-labelledby="situationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <h5 class="modal-title text-center p-3">Explanation</h5>
                <div class="modal-body text-center">
                    <div class="row">
                        <!-- Left Column for Haber -->
                        <div class="col-md-6">
                            <strong class="existence">Haber (Existence & Experience)</strong>
                            <ul>
                                <li><strong class="existence">Existence</strong>: Hay un libro en la mesa. (There is a book on the table.)</li>
                                <li><strong class="experience">Experience</strong>: He vivido en Espa√±a. (I have lived in Spain.)</li>
                            </ul>
                        </div>

                        <!-- Right Column for Tener -->
                        <div class="col-md-6">
                            <strong class="possession">Tener (Possession & Obligation)</strong>
                            <ul>
                                <li><strong class="possession">Possession</strong>: Tengo un coche. (I have a car.)</li>
                                <li><strong class="obligation">Obligation</strong>: Tengo que estudiar. (I have to study.)</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary mx-auto w-50 mb-3" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
{% endif %}
<!--Event lister that sends request to api/_user_exercise_choice-->
<script>
   async function startPractice() {
        console.log("üöÄ startPractice() triggered");

        const conjugationBtn = document.getElementById("conjugationBtn");
        if (!conjugationBtn) {
            console.error("‚ùå ERROR: Conjugation button not found!");
            return;
        }

        const isConjugation = conjugationBtn.classList.contains("highlighted");
        console.log("üü° Detected mode:", isConjugation ? "conjugation" : "reasoning");

        let selectedTenses = [];
        if (isConjugation) {
            const selectedTensesElement = document.getElementById("selectedTenses");
            if (!selectedTensesElement) {
                console.error("‚ùå ERROR: Selected tenses element not found!");
                return;
            }

            selectedTenses = JSON.parse(selectedTensesElement.value || "[]");
            console.log("üìå Selected Tenses:", selectedTenses);

            if (selectedTenses.length === 0) {
                alert("Please select at least one tense before starting practice.");
                return;
            }

            // ‚úÖ Store selected tenses in sessionStorage
            sessionStorage.setItem("selectedTenses", JSON.stringify(selectedTenses));
        }

        // ‚úÖ Construct the redirect URL with the selected exercise
        let exerciseKey = "{{ exercise_key }}";
        let redirectURL = `/practice?exercise=${exerciseKey}&mode=${isConjugation ? "conjugation" : "reasoning"}`;
        console.log("üîó Redirecting to:", redirectURL);
        window.location.href = redirectURL;
    }


</script>

<script>

const EXPLANATIONS = {
  TopLevel: {
    Reasoning: `
      This is the explanation for "Reasoning" mode.
      You decide when to use ser/estar/haber/tener, focusing on logic or context.
    `,
    Conjugations: `
      This is the explanation for "Conjugations" mode.
      Practice forming the correct tense endings (Present, Past, Subjunctive, etc.).
    `,
  },
  Mood: {
    Indicative: `
      The Indicative mood is used for statements of fact or certainty.
      Examples: "I eat", "He has studied", etc.
    `,
    Subjunctive: `
      The Subjunctive mood is used for doubt, desire, emotion, or uncertainty.
      Examples: "It's important that he eat", "I want you to go", etc.
    `,
    Imperative: `
      The Imperative mood is used for giving commands.
      Examples: "Speak!", "Don't run!", etc.
    `,
  },
  Tense: {
    Present: `
      The Present tense expresses actions happening now or in the near future.
      Example: "I speak", "I am speaking", etc.
    `,
    Present_Perfect: `
      The Present Perfect tense expresses actions that started in the past and
      continue or repeat in the present. Example: "I have spoken".
    `,
    Past_Imperfect: `
      The Past Imperfect tense describes ongoing or habitual past actions.
      Example: "I used to speak every day".
    `,
    Past_Perfect: `
      The Past Perfect (pluscuamperfecto) describes an action that happened
      before another past event. Example: "I had spoken before he arrived."
    `,
    Future: `
      The Future tense indicates actions that will happen.
      Example: "I will speak."
    `,
    Future_Perfect: `
      The Future Perfect indicates actions that will have been completed
      by a future point. Example: "I will have spoken."
    `,
    Conditional: `
      The Conditional tense indicates what would happen under certain conditions.
      Example: "I would speak (if...)."
    `,
    Present_Subjunctive: `
      Present Subjunctive is used after certain expressions of doubt, emotion,
      necessity, etc. Example: "Quiero que hables."
    `,
    Present_Perfect_Subjunctive: `
      Expresses a subjunctive action that happened in the past and is closely
      connected to the present. Example: "Es bueno que hayas hablado."
    `,
    Past_Imperfect_Subjunctive: `
      Used in subordinate clauses requiring subjunctive when the main clause
      is in past tense. Example: "Quer√≠a que hablaras."
    `,
    Past_Perfect_Subjunctive: `
      Describes something that had happened before another action in the past,
      in a subjunctive context. Example: "Esperaba que hubieras hablado."
    `,
    Affirmative_Imperative: `
      Used for direct commands telling someone to do something.
      Example: "Speak now! (¬°Habla!)"
    `,
    Negative_Imperative: `
      Used for commands telling someone NOT to do something.
      Example: "Don't speak! (¬°No hables!)"
    `,
  }
};


</script>







    <!-- STEP 1: "Reasoning" and "Conjugations" + NOT SURE? (Top Level) -->
    <div class="mt-5 text-center">
      <h3>Choose Your Focus</h3>
      <div class="d-flex justify-content-center gap-3 mt-3">
        
        <!-- Top-Level Buttons -->
<button class="btn reasoning-button" id="reasoningBtn" onclick="selectMode('reasoning')">
  Reasoning
</button>

<button class="btn conjugations-button" id="conjugationBtn" onclick="selectMode('conjugation')">
  Conjugations
</button>

        <!-- The "Not Sure?" for top-level -->
        <button class="btn btn-outline-info" onclick="toggleNotSure(this)">
          Not Sure?
        </button>
      </div>

      <!-- Explanation text for top-level "Not Sure?" mode -->
      <p id="not-sure-top-text" class="text-center mt-3" style="display: none;">
        Pressing "Reasoning" or "Conjugations" will give an explanation.
    </p>
    
    <p id="not-sure-conjugation-text" class="text-center mt-3" style="display: none;">
        Pressing "Moods" or "Tenses" will give an explanation.
    </p>
    </div>

    <!-- Moods are only shown if Conjugations is "on" -->
    <div id="mood-buttons" class="mt-4" style="display: none;">
      <h4 class="text-center">Select Moods</h4>
      <div class="d-flex justify-content-center gap-3 mt-3">
        <!-- Mood Buttons -->
        <button class="btn btn-outline-primary" 
                onclick="handleButtonClick(this, 'Indicative', 'Mood')">
          Indicative
        </button>
        <button class="btn btn-outline-danger" 
                onclick="handleButtonClick(this, 'Subjunctive', 'Mood')">
          Subjunctive
        </button>
        <button class="btn btn-outline-warning" 
                onclick="handleButtonClick(this, 'Imperative', 'Mood')">
          Imperative
        </button>
      </div>

      <!-- Not Sure Button for Moods -->
      
      <p id="not-sure-text" class="text-center mt-3" style="display: none;">
        Pressing a mood or tense will give an explanation.
      </p>
    </div>

    <!-- Tenses for each Mood -->
   <!-- Tenses for each Mood (Updated for Indicative) -->
<div id="indicative-tenses" class="mt-4" style="display: none;">
  <h4 class="text-center">Indicative Tenses</h4>
  <div class="d-flex justify-content-center gap-3 mt-3">
    <button class="btn btn-outline-primary" onclick="toggleTense(this, 'Present', 'Tense')">Present</button>
    <button class="btn btn-outline-info" onclick="toggleTense(this, 'Present Perfect')">Present Perfect</button>
    <button class="btn btn-outline-secondary" onclick="toggleTense(this, 'Past Imperfect')">Past Imperfect</button>
    <button class="btn btn-outline-danger" onclick="toggleTense(this, 'Past Perfect')">Past Perfect</button>
    <button class="btn btn-outline-success" onclick="toggleTense(this, 'Future')">Future</button>
    <button class="btn btn-outline-dark" onclick="toggleTense(this, 'Future Perfect')">Future Perfect</button>
    <button class="btn btn-outline-warning" onclick="toggleTense(this, 'Conditional')">Conditional</button> 

  </div>
</div>
<!-- Hidden input to store selected tenses -->
<input type="hidden" id="selectedTenses" name="selectedTenses" value="">








<script>
  let selectedTenses = [];
  function toggleTense(button, name) {
    if (states.notSure) {
        showTenseExplanation(name, "Tense");
        return;
    }

    const formattedName = name.replace(/\s/g, "_");

    if (selectedTenses.includes(formattedName)) {
        selectedTenses = selectedTenses.filter(t => t !== formattedName);
        button.classList.remove("highlighted");
    } else {
        selectedTenses.push(formattedName);
        button.classList.add("highlighted");
    }

    document.getElementById("selectedTenses").value = JSON.stringify(selectedTenses);
    console.log("‚úÖ Selected Tenses:", selectedTenses);
}



</script>

<!-- Button to start practice with selected tenses -->
<div class="text-center mt-4">
  <a href="#" class="btn btn-primary" onclick="startPractice()">Start Practice</a>
</div>



<!--selectMode function that redirects user to practice page with mode parameter-->>


<script>
  function selectMode(mode) {
    console.log("üîÑ selectMode() triggered - Mode:", mode);

    const reasoningBtn = document.getElementById("reasoningBtn");
    const conjugationBtn = document.getElementById("conjugationBtn");

    if (!reasoningBtn || !conjugationBtn) {
        console.error("‚ùå ERROR: One or both mode buttons not found!");
        return;
    }

    // Toggle active class based on selection
    if (mode === "reasoning" && states.notSure === false) {
        reasoningBtn.classList.add("highlighted");
        conjugationBtn.classList.remove("highlighted");

        // Hide mood/tenses UI
        document.getElementById("mood-buttons").style.display = "none";
    } else if (mode === "conjugation" && states.notSure === false) {
        conjugationBtn.classList.add("highlighted");
        reasoningBtn.classList.remove("highlighted");

        // Show mood/tenses UI
        document.getElementById("mood-buttons").style.display = "block";
    }
}

function selectMood(mood) {
    console.log("Selected mood:", mood);

    // Hide all tense sections first
    document.getElementById("indicative-tenses").style.display = "none";
    document.getElementById("subjunctive-tenses").style.display = "none";
    document.getElementById("imperative-tenses").style.display = "none";

    // Show the selected mood‚Äôs tenses
    if (mood === "Indicative") {
        document.getElementById("indicative-tenses").style.display = "block";
    } else if (mood === "Subjunctive") {
        document.getElementById("subjunctive-tenses").style.display = "block";
    } else if (mood === "Imperative") {
        document.getElementById("imperative-tenses").style.display = "block";
    }
}

document.addEventListener("DOMContentLoaded", function () {
    console.log("‚úÖ DOM fully loaded");

    let reasoningBtn = document.getElementById("reasoningBtn");
    let conjugationBtn = document.getElementById("conjugationBtn");

    if (!reasoningBtn || !conjugationBtn) {
        console.error("‚ùå ERROR: Buttons not found!");
        return;
    }

    reasoningBtn.addEventListener("click", function() {
        console.log("üü¢ 'Reasoning' button clicked!");
        handleTopLevelButtonClick(reasoningBtn, "Reasoning");
       
    });

    conjugationBtn.addEventListener("click", function() {
      
        console.log("üü¢ 'Conjugations' button clicked!");
        handleTopLevelButtonClick(conjugationBtn, "Conjugations");
    });

    console.log("‚úÖ Event listeners added successfully");
});

</script>

<!-- Tenses for each Mood: Subjunctive -->
<div id="subjunctive-tenses" class="mt-4" style="display: none;">
  <h4 class="text-center">Subjunctive Tenses</h4>
  <div class="d-flex justify-content-center gap-3 mt-3">
    <button class="btn btn-outline-primary" onclick="toggleTense(this, 'Present Subjunctive')">Present Subjunctive</button>
    <button class="btn btn-outline-info" onclick="toggleTense(this, 'Present Perfect Subjunctive')">Present Perfect Subjunctive</button>
    <button class="btn btn-outline-secondary" onclick="toggleTense(this, 'Past Imperfect Subjunctive')">Past Imperfect Subjunctive</button>
    <button class="btn btn-outline-danger" onclick="toggleTense(this, 'Past Perfect Subjunctive')">Past Perfect Subjunctive</button>
  </div>
</div>

<!-- Tenses for each Mood: Imperative -->
<div id="imperative-tenses" class="mt-4" style="display: none;">
  <h4 class="text-center">Imperative Tenses</h4>
  <div class="d-flex justify-content-center gap-3 mt-3">
    <button class="btn btn-outline-primary" onclick="toggleTense(this, 'Affirmative Imperative')">Affirmative Imperative</button>
    <button class="btn btn-outline-secondary" onclick="toggleTense(this, 'Negative Imperative')">Negative Imperative</button>
  </div>
</div>
  </div>

  <!-- Explanation Modal (Shared for All "Not Sure?" Interactions) -->
  <div class="modal fade" id="explanationModal" 
       tabindex="-1" 
       aria-labelledby="modal-title" 
       aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="modal-title" class="modal-title"></h5>
          <button type="button" class="btn-close" 
                  data-bs-dismiss="modal" 
                  aria-label="Close">
          </button>
        </div>
        <div id="modal-body" class="modal-body"></div>
        <div class="modal-footer">
          <button class="btn btn-secondary" 
                  data-bs-dismiss="modal">
            Close
          </button>
          <button class="btn btn-primary" onclick="addOption()">
            Add
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Global State
    const states = {
      // Top-level toggles
      reasoningSelected: false,
      conjugationsSelected: false,

      // Moods
      indicativeSelected: false,
      subjunctiveSelected: false,
      imperativeSelected: false,

      // "Not Sure?" states
      notSure: false  // for Reasoning/Conjugations for Moods/Tenses
    };

    // For tracking which button triggered the modal
    let lastTargetButton = null;
    let lastTargetMode = null; 




    
    /*
      ---------------------------------------------------------
      A) TOP-LEVEL LOGIC ("Reasoning" / "Conjugations") + NOT SURE?
      ---------------------------------------------------------
    */

    // Toggle the top-level "Not Sure?" mode
    function toggleNotSure(button) {
        states.notSure = !states.notSure;
        button.classList.toggle("highlighted", states.notSure);

        // Show or hide the primary "Not Sure?" explanation
        const txt = document.getElementById("not-sure-top-text");
        txt.style.display = states.notSure ? "block" : "none";

          // Check if Conjugations is also ON
    updateNotSureConjugationMessage();
      }

function handleTopLevelButtonClick(button, name) {
    console.log(`üîπ Handling Button Click: ${name}`);

    const stateKey = name === "Reasoning" ? "reasoningSelected" : "conjugationsSelected";

    // 1. If the button is already active, toggle it off immediately
    if (states[stateKey]) {
        console.log(`üîÑ ${name} was active, toggling OFF.`);
        toggleExercise(button, stateKey);
        return;
    }

    // 2. If "Not Sure?" is active, show the modal instead of activating immediately
    console.log(`üìå Current state of "Not Sure?": ${states.notSure}`);

    if (states.notSure) {
        console.log(`üü° 'Not Sure?' is TRUE. Showing modal for ${name}...`);
        lastTargetButton = button;  // Store button reference for later activation
        // Store which mode to activate

        showModal(name);
        return;
    }
    if (states.notSure) {
        console.log(`üü° 'Not Sure?' is TRUE. Showing msadasdasds for ${name}...`);
        lastTargetButton = button;  // Store button reference for later activation
        // Store which mode to activate

        showModal(name);
        return;
    }

    // 3. Otherwise, activate the mode directly
    console.log(`‚úÖ Activating ${name} directly.`);
    toggleExercise(button, stateKey);
}






    // The same toggle logic as before, but also hide/show Moods if Conjugations toggled
    function toggleExercise(button, exercise) {
    // Toggle the selected exercise state
    states[exercise] = !states[exercise];
    button.classList.toggle("highlighted", states[exercise]);

    // If "Conjugations" is toggled, show/hide the mood buttons
    if (exercise === "conjugationsSelected") {
        const moodButtons = document.getElementById("mood-buttons");
        moodButtons.style.display = states[exercise] ? "block" : "none";
    }

    // Update the additional explanation message for "Moods/Tenses"
    updateNotSureConjugationMessage();
}
    function updateNotSureConjugationMessage() {
    const notSureConjugationText = document.getElementById("not-sure-conjugation-text");

    // Show if "Not Sure?" and "Conjugations" are both ON
    if (states.notSure && states.conjugationsSelected) {
        notSureConjugationText.style.display = "block";
    } else {
        notSureConjugationText.style.display = "none";
    }
}



    /*
      ---------------------------------------------------------
      B) MOOD / TENSE LOGIC + "Not Sure?" (for Moods)
      ---------------------------------------------------------
    */

 

    // Handle a click on a Mood or Tense button
   function handleButtonClick(button, name, type) {
    // If button is already highlighted, just toggle it off
    if (button.classList.contains("highlighted")) {
      toggleContent(button, name, type);
      return;
    }
    // If "Not Sure?" is toggled on for moods/tenses, open modal with dummy text
    if (states.notSure) {
      lastTargetButton = button;
      // Show a dummy text explanation
      showTenseExplanation(name, type);
    } else {
      // Normal behavior: highlight/unhighlight and show/hide tenses if it's a mood
      toggleContent(button, name, type);
    }
  }

      // Actually toggles highlight and displays the right tenses
  function toggleContent(button, name, type) {
    button.classList.toggle("highlighted");
    const isOn = button.classList.contains("highlighted");

    if (type === "Mood") {
      // e.g. 'indicativeSelected' = true/false
      const moodKey = name.toLowerCase() + "Selected";
      states[moodKey] = isOn;
      displayTenses(name.toLowerCase());
    }
    // If 'Tense', no special logic needed besides toggling highlight
  }

    // Show/hide the tenses for the selected mood
    function displayTenses(mood) {
      const tensesElem = document.getElementById(mood + "-tenses");
      if (!tensesElem) return;

      const moodKey = mood + "Selected";
      tensesElem.style.display = states[moodKey] ? "block" : "none";
    }

    /*
      ---------------------------------------------------------
      C) MODAL LOGIC (Used by BOTH top-level & mood/tense "Not Sure?")
      ---------------------------------------------------------
    */
    function showTenseExplanation(name, type) {
    const modalElem = document.getElementById("explanationModal");
    if (!modalElem) {
        console.error("‚ùå Modal element not found!");
        return;
    }

    const modal = new bootstrap.Modal(modalElem);
    const modalTitle = document.getElementById("modal-title");
    const modalBody = document.getElementById("modal-body");

    // Store last clicked button for "Add" functionality
    lastTargetButton = event.target;

    // Convert name to dictionary key format
    const formattedName = name.replace(/\s/g, "_");

    let explanationText = `No explanation found for ${name} (${type}).`;
    if (type === "Tense" && EXPLANATIONS.Tense[formattedName]) {
        explanationText = EXPLANATIONS.Tense[formattedName];
    } 
    else if (type === "Mood" && EXPLANATIONS.Mood[name]) {
        explanationText = EXPLANATIONS.Mood[name];
    }

    modalTitle.textContent = `Explanation for ${name} (${type})`;
    modalBody.textContent = explanationText;

    modal.show();
}


   
   
// Show a bootstrap modal with explanation for Reasoning or Conjugations
function showModal(name, callback = null) {
    console.log(`üõ† ENTERING showModal(${name})`);

    const modalElem = document.getElementById("explanationModal");
    if (!modalElem) {
        console.error("‚ùå ERROR: explanationModal NOT FOUND in DOM.");
        return;
    }

    console.log("‚úÖ Modal element FOUND. Proceeding to show...");

    const modal = new bootstrap.Modal(modalElem);
    const modalTitle = document.getElementById("modal-title");
    const modalBody = document.getElementById("modal-body");

    modalTitle.textContent = `Explanation: ${name}`;
    
    if (name === "Reasoning") {
      //for reasoning
        modalBody.textContent = 
            "- Reasoning mode helps determine the correct verb based on **context**.\n" +
            "-For example: **Ser** is used for identity, characteristics, origin, and definitions.\n" +
            "- **Estar** is used for emotions, locations, conditions, and ongoing actions.";
    } else if (name === "Conjugations") {
      //for conjugations
        modalBody.textContent = 
            "- Conjugation mode focuses on practicing different verb tenses.\n" +
            "- You'll need to select the correct tense of the verb in the blank.";
    } else if (name === "Tenses") {
       // For Moods/Tenses
       modalBody.textContent = `Explanation for ${name} (${type}). This is when and how it is used.`;
    }

    modal.show();
    console.log("‚úÖ Modal SHOW command executed.");

    modalElem.addEventListener("hidden.bs.modal", function () {
        console.log(`‚úÖ Modal for ${name} was closed.`);
        if (callback) {
            console.log("Executing callback...");
            callback();
        }
    }, { once: true });
}
function addOption() {
    if (!lastTargetButton) {
        console.error("‚ùå ERROR: No button was stored in lastTargetButton.");
        return;
    }

    // Extract name and type from modal title
    const fullTitle = document.getElementById("modal-title").textContent;
    let name = "", type = "";

    if (fullTitle.includes("(")) {
        const match = fullTitle.match(/Explanation for (.+) \((.+)\)/);
        if (match) {
            name = match[1].trim();
            type = match[2].trim();
        }
    } else if (fullTitle.includes(":")) {
        const match = fullTitle.match(/Explanation: (.+)/);
        if (match) {
            name = match[1].trim();
            type = "TopLevel";
        }
    } else {
        console.error("‚ùå Could not extract name/type from modal title:", fullTitle);
        return;
    }

    console.log(`üõ† 'Add' clicked for ${type}: ${name}`);

    let targetButton = lastTargetButton;

    // Manually find the correct button if lastTargetButton is incorrect
    if (!targetButton || !targetButton.classList.contains("btn")) {
        console.warn("‚ö†Ô∏è lastTargetButton seems incorrect, manually searching...");
        targetButton = Array.from(document.querySelectorAll("button")).find(
            (btn) => btn.textContent.trim() === name
        );
    }

    if (!targetButton) {
        console.error(`‚ùå Could not find a button matching "${name}".`);
        return;
    }

    // ‚úÖ Ensure the button visually updates
    targetButton.classList.add("highlighted");

    if (type === "TopLevel") {
        if (name === "Reasoning") {
            states.reasoningSelected = true;
            document.getElementById("mood-buttons").style.display = "none"; 
        } else if (name === "Conjugations") {
            states.conjugationsSelected = true;
            document.getElementById("mood-buttons").style.display = "block"; 
        }

        // ‚úÖ Manually find and highlight the correct button
        const topButtons = document.querySelectorAll(".reasoning-button, .conjugations-button");
        topButtons.forEach((btn) => {
            if (btn.textContent.trim() === name) {
                btn.classList.add("highlighted");
            }
        });

    } else if (type === "Mood") {
        const moodKey = name.toLowerCase() + "Selected";
        states[moodKey] = true;
        displayTenses(name.toLowerCase());
        console.log(`‚úÖ Mood "${name}" activated.`);
    } else if (type === "Tense") {
        const formattedName = name.replace(/\s/g, "_");

        if (!selectedTenses.includes(formattedName)) {
            selectedTenses.push(formattedName);
        }

        document.getElementById("selectedTenses").value = JSON.stringify(selectedTenses);
        console.log(`‚úÖ Tense "${formattedName}" added to selection.`);

        // üîπ Find and highlight the corresponding button manually
        const tenseButtons = document.querySelectorAll("button");
        tenseButtons.forEach((btn) => {
            if (btn.textContent.trim() === name) {
                btn.classList.add("highlighted");
            }
        });
    }

    // Close modal
    const modalElem = document.getElementById("explanationModal");
    const modal = bootstrap.Modal.getInstance(modalElem);
    modal.hide();

    console.log(`‚úÖ ${type} "${name}" added.`);
    lastTargetButton = null;
}



  </script>
</body>
</html>
